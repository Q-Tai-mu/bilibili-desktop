<template>
  <el-menu default-active="/recommend" class="aside" :router="true" :collapse="true">
    <div class="logo-wrap">
      <img src="../../assets/logo.png" alt="" width="48">
    </div>
    <el-menu-item index="/recommend">
      <el-icon><House /></el-icon>
      <template #title>推荐</template>
    </el-menu-item>
    <el-menu-item index="/hot">
      <el-icon>
        <svg t="1637061850179" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="27815" width="32" height="32"><path d="M512 973.791c-52.461 0-103.358-10.689-151.278-31.771-46.168-20.311-87.599-49.354-123.143-86.323-35.445-36.868-63.266-79.779-82.688-127.543-20.079-49.376-30.26-101.791-30.26-155.789 0-76.174 20.685-150.313 59.818-214.401 10.648-17.44 33.421-22.946 50.86-12.296 17.44 10.649 22.945 33.42 12.296 50.861C215.566 449 198.63 509.804 198.63 572.366c0 180.544 140.577 327.427 313.369 327.427S825.368 752.91 825.368 572.366c0-110.518-52.83-212.837-141.32-273.704-16.836-11.581-21.097-34.617-9.516-51.453 11.58-16.836 34.617-21.097 51.453-9.516 108.566 74.677 173.383 199.789 173.383 334.674 0 53.998-10.181 106.413-30.259 155.789-19.424 47.764-47.244 90.676-82.689 127.543-35.543 36.97-76.975 66.013-123.142 86.324-47.919 21.078-98.816 31.768-151.278 31.768z" p-id="27816"></path><path d="M294.752 517.054c-2.053 0-4.121-0.171-6.188-0.521-23.418-3.969-44.603-23.504-73.119-67.428-16.428-25.304-29.16-49.675-29.694-50.7-9.44-18.123-2.402-40.468 15.721-49.909 18.119-9.441 40.464-2.405 49.905 15.715 0.212 0.404 9.875 18.854 22.492 38.897 4.915 7.808 9.235 14.218 12.989 19.471 9.437-16.672 20.913-38.662 32.433-64.923 24.901-56.77 55.18-145.879 58.018-248.004a37 37 0 0 1 51.565-32.98c2.023 0.867 50.15 21.817 102.025 71.623 30.269 29.062 55.959 62.223 76.356 98.561 14.638 26.078 26.541 53.808 35.616 82.916 7.76-15.36 15.787-36.988 22.426-67.31 4.369-19.961 24.091-32.601 44.057-28.231 19.962 4.37 32.602 24.096 28.23 44.057-30.781 140.595-96.974 158.175-109.931 160.272a36.998 36.998 0 0 1-42.465-30.799c-19.639-125.377-90.362-198.141-138.58-234.211-10.84 88.552-37.648 164.273-60.441 215.857-30.354 68.694-60.104 110.469-61.355 112.214a37.01 37.01 0 0 1-30.06 15.433z m11.917-71.585z m306.075-79.267c0 0.001 0 0.001 0 0 0 0.001 0 0.001 0 0z" p-id="27817"></path></svg>
      </el-icon>
      <template #title>热门</template>
    </el-menu-item>
    <el-menu-item index="/ranking">
      <el-icon><el-icon><Trophy /></el-icon></el-icon>
      <template #title>排行榜</template>
    </el-menu-item>
    <el-menu-item index="/partition">
      <el-icon>
        <svg t="1636905247355" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8855" width="200" height="200"><path d="M376.832 474.112H130.048c-33.792 0-61.44-27.648-61.44-61.44V165.888c0-33.792 27.648-61.44 61.44-61.44h247.296c33.792 0 61.44 27.648 61.44 61.44v247.296c-0.512 33.792-27.648 60.928-61.952 60.928zM130.048 165.888v247.296h247.296V165.888H130.048zM739.84 525.312c-16.384 0-31.744-6.144-43.52-17.92L521.728 332.8c-11.776-11.776-17.92-27.136-17.92-43.52s6.144-31.744 17.92-43.52L696.32 71.168c11.776-11.776 27.136-17.92 43.52-17.92s31.744 6.144 43.52 17.92L957.952 245.76c11.776 11.776 17.92 27.136 17.92 43.52s-6.144 31.744-17.92 43.52L783.36 507.392c-11.776 11.776-27.136 17.92-43.52 17.92z m0-411.136l-174.592 174.592 174.592 174.592 174.592-174.592-174.592-174.592zM376.832 960.512H130.048c-33.792 0-61.44-27.648-61.44-61.44v-247.296c0-33.792 27.648-61.44 61.44-61.44h247.296c33.792 0 61.44 27.648 61.44 61.44v247.296c-0.512 34.304-27.648 61.44-61.952 61.44z m-246.784-308.224v247.296h247.296v-247.296H130.048zM863.232 960.512h-247.296c-33.792 0-61.44-27.648-61.44-61.44v-247.296c0-33.792 27.648-61.44 61.44-61.44h247.296c33.792 0 61.44 27.648 61.44 61.44v247.296c0 34.304-27.136 61.44-61.44 61.44z m-246.784-308.224v247.296h247.296v-247.296h-247.296z" p-id="8856"></path></svg>
      </el-icon>
      <template #title>分区</template>
    </el-menu-item>
    <el-menu-item index="/live">
      <el-icon><VideoCamera /></el-icon>
      <template #title>直播</template>
    </el-menu-item>
    <el-menu-item index="/dynamic">
      <el-icon>
        <svg t="1637062084639" class="icon" viewBox="0 0 1362 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="49388" width="32" height="32"><path d="M1360.914746 342.264225c-13.892024-55.442188-105.722082-88.682318-240.613219-95.607346a514.382629 514.382629 0 0 0-952.715868 239.689882C50.741563 554.253998-11.835501 623.54624 2.056523 681.716469c13.892024 55.442188 105.722082 88.682318 237.843208 95.607346a515.305966 515.305966 0 0 0 954.184814-239.689882c115.333181-66.522231 180.722226-137.199479 166.830201-195.369708zM680.751162 94.22234a418.481494 418.481494 0 0 1 346.335302 181.519654 18.466739 18.466739 0 0 1 4.196986 6.925027 194.278491 194.278491 0 0 0 16.787945 24.930098 18.424769 18.424769 0 0 1 4.196986 6.925027 405.009169 405.009169 0 0 1 48.68504 170.43961 1807.432108 1807.432108 0 0 1-389.48032 141.312525 2022.94735 2022.94735 0 0 1-411.724346 58.212199 407.821149 407.821149 0 0 1-37.563027-170.43961 418.901193 418.901193 0 0 1 418.523464-419.82453zM109.079671 662.326393c-2.770011-2.770011-6.966997-2.770011-9.737008-4.196986 2.770011-2.770011 4.196986-4.196986 4.196987-6.925028a270.285911 270.285911 0 0 1 68.159056-55.442187 430.820634 430.820634 0 0 0 20.984931 85.912307 628.288835 628.288835 0 0 1-83.645935-19.348106z m571.671491 268.607117a418.649374 418.649374 0 0 1-326.861285-155.28849 1956.257239 1956.257239 0 0 0 378.358306-58.170229 1891.833501 1891.833501 0 0 0 361.654301-125.909586 418.229675 418.229675 0 0 1-413.193292 339.578154zM1255.234634 375.294506a344.698477 344.698477 0 0 1-68.159056 58.212199 430.652754 430.652754 0 0 0-20.984931-85.912308 370.426002 370.426002 0 0 1 86.248066 18.005071c2.770011 2.770011 6.966997 2.770011 9.737008 4.196986-1.385005 1.552885-4.113046 2.93789-6.883057 5.707902z" p-id="49389"></path><path d="M377.476939 512.703835a47.300035 47.300035 0 1 0 47.300035-47.132155 47.719733 47.719733 0 0 0-47.300035 47.132155zM775.267291 327.029165a69.628001 69.628001 0 0 0 69.544062 69.292242 69.292242 69.292242 0 1 0 0-138.500545 69.628001 69.628001 0 0 0-69.544062 69.208303zM587.494129 814.760932a47.300035 47.300035 0 1 0 47.300034-47.132155 48.64307 48.64307 0 0 0-47.300034 47.132155z" p-id="49390"></path></svg>
      </el-icon>
      <template #title>动态</template>
    </el-menu-item>
    <div class="user">
      <el-avatar :size="38" :icon="User" @click="showDialog"></el-avatar>
    </div>
    <el-dialog
      v-model="loginDialog"
      title="扫码登录"
      width="350px"
      :close-on-click-modal="false"
      @close="clearTimer"
    >
      <div class="dialog-contain">
        <div v-loading="loading" class="qrcode-wrap">
          <qrcode-vue  :value="loginUrl" :size="250" level="L" />
        </div>
        <span>请使用移动客户端扫描上方二维码</span>
      </div>
    </el-dialog>
  </el-menu>
</template>

<script setup lang="ts">
import {
  House,
  Trophy,
  VideoCamera,
  Setting,
  User,
} from "@element-plus/icons";
import { getLoginUrlApi, loginApi } from "@/api/system/user";
import { ref } from "vue";
import QrcodeVue from 'qrcode.vue'

const loginDialog = ref(false)
const loginUrl = ref('')
const loading = ref(true)
let timer: NodeJS.Timer | null = null
const getLoginUrl = async () => {
  loading.value = true
  const res = await getLoginUrlApi()
  loginUrl.value = res.data.url
  loading.value = false
  timer = setInterval(() => {
    login(res.data.oauthKey)
  }, 1000)
}

const login = async (oauthKey:string) => {
  const res = await loginApi({oauthKey})
  if(res.code == 0) loginDialog.value = false
}

const clearTimer = () => {
  clearInterval(Number(timer))
}

const showDialog = () => {
  getLoginUrl()
  loginDialog.value = true
}

</script>

<style lang="scss" scoped>
.aside {
  height: 100%;
  -webkit-app-region: drag;
  .logo-wrap {
    padding-top: 55px;
    padding-bottom: 30px;
    text-align: center;
  }
  .el-menu-item {
    -webkit-app-region: no-drag;
  }
  .user {
    width: 63px;
    height: 56px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 32px;
    cursor: pointer;
    -webkit-app-region: no-drag;
  }
  .dialog-contain {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    flex-direction: column;
    .tip {
      color: #d8d8d8;
    }
  }
}
</style>
